<mat-sidenav-container class="sidenav-container">
  <mat-sidenav
    #drawer
    class="sidenav"
    color="primary"
    [fixedInViewport]="false"
    [attr.role]="(isHandset$ | async) ? 'dialog' : 'navigation'"
    [mode]="(isHandset$ | async) ? 'over' : 'side'"
    [opened]="(isHandset$ | async) === false"
  >
    <mat-toolbar>
      <p class="sidenav-name">
        {{
          businessState.business
            ? businessName
            : user.userProfile.firstName + " " + user.userProfile.lastName
        }}
      </p>
    </mat-toolbar>
    <mat-slide-toggle
      (change)="onThemeModeSwitched($event)"
      [checked]="user.userProfile.themePref === 'theme-dark' ? true : false"
      >Dark Mode</mat-slide-toggle
    >
    <mat-nav-list>
      <a mat-list-item routerLink="/app/dashboard" routerLinkActive="active">
        <mat-icon class="sidenav-icon">dashboard</mat-icon>Dashboard
      </a>
      <a mat-list-item routerLink="/app/dashboard" routerLinkActive="active">
        <mat-icon class="sidenav-icon">trending_up</mat-icon>Insights
      </a>
      <a mat-list-item routerLink="/app/products" routerLinkActive="active">
        <mat-icon class="sidenav-icon">sell</mat-icon>Products
      </a>
      <a mat-list-item routerLink="/app/inventory" routerLinkActive="active">
        <mat-icon class="sidenav-icon">addchart</mat-icon>New Inventory
      </a>
        <mat-form-field
          *ngIf="
            userRole === 'owner' && businessState.businessLocations.length > 1
          "
          class="location-select"
          appearance="outline"
          matTooltip="You have multiple locations to choose from. Select one to work on."
          >
          <mat-label>
            {{
              activatedLocation
              ? activatedLocation.locationName + " selected"
              : "Select Location"
            }}
          </mat-label>
          <mat-select
          [(ngModel)]="activatedLocation"
          name="activatedLocation"
          [selected]="activatedLocation ? activatedLocation : selected"
          (selectionChange)="onActivateLocation(activatedLocation)"
          >
            <mat-option
              class="location-select-dropdown"
              #selectedValue
              *ngFor="let location of multiBizLocations"
              [value]="location"
            >
              {{ location.locationName }}
            </mat-option>
          </mat-select>
          <mat-hint>Multiple locations detected.</mat-hint>
        </mat-form-field>


      <span class="spacer"></span>

      <mat-error *ngIf="locationState.locationError" class="no-locations">
        {{ locationState.locationError }}
      </mat-error>

      <!-- SHOW 'MANAGE BUSINESS' LINK IF USER IS OWNER -->
      <a
        *ngIf="userRole === 'owner'"
        mat-list-item
        routerLink="/app/business"
        routerLinkActive="active"
      >
        <mat-icon class="sidenav-icon">business</mat-icon>Business
      </a>

      <!-- **OWNER** -->
      <!-- SHOW SINGLE 'MANAGE LOCATION' LINK IF **OWNER** BUSINESS ONLY HAS ONE LOCATION -->
      <a
        *ngIf="
          userRole === 'owner' && businessState.businessLocations.length === 1
        "
        mat-list-item
        routerLink="/app/location"
        routerLinkActive="active"
      >
        <mat-icon class="sidenav-icon">store</mat-icon
        >{{ singleBizLocationName }}
      </a>

      <!-- **USER* -->
      <!-- SHOW SINGLE 'MANAGE LOCATION' LINK IF **USER** ONLY HAS ACCESS TO ONE LOCATION -->
      <a
        *ngIf="userRole !== 'staff' && locationState.userLocations.length === 1"
        mat-list-item
        [routerLink]="manageRoute"
        routerLinkActive="active"
      >
        <mat-icon class="sidenav-icon">{{ manageIcon }}</mat-icon
        >{{ singleUserLocationName }}
      </a>
      <a mat-list-item routerLink="/app/settings" routerLinkActive="active">
        <mat-icon class="sidenav-icon settings">settings</mat-icon>User Settings
      </a>
      <a mat-list-item routerLink="/app/support" routerLinkActive="active">
        <mat-icon class="sidenav-icon">support_agent</mat-icon>Tech Support
      </a>
      <a
        *ngIf="isAuthenticated"
        mat-stroked-button
        type="button"
        class="btn logout"
        (click)="onLogout()"
        >Log Out</a
      >
      <p *ngIf="isAuthenticated" class="user-display">
        {{
          user
            ? "Logged in as " +
              user.userProfile.firstName +
              " " +
              user.userProfile.lastName
            : "Logged in as " + user.email
        }}
        <br />
        {{ user ? "(" + user.email + ")" : null }}
      </p>
    </mat-nav-list>
  </mat-sidenav>
  <mat-sidenav-content>
    <mat-toolbar color="primary" role="heading">
      <button
        type="button"
        aria-label="Toggle sidenav"
        mat-icon-button
        (click)="drawer.toggle(); toggleSideNav()"
        *ngIf="isHandset$"
      >
        <mat-icon *ngIf="!sideNavOpen" aria-label="Side nav toggle icon"
          >menu
        </mat-icon>
        <mat-icon *ngIf="sideNavOpen">menu_open</mat-icon>
      </button>
      <img src="../../../assets/inv-logo.webp" alt="Inventory App logo" />
    </mat-toolbar>
    <router-outlet></router-outlet>
  </mat-sidenav-content>
</mat-sidenav-container>
